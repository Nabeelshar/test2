import{f as C,h as y,X as g,V as M,g as O,ah as S,o as D,d as K,e as k,N,k as A,bU as V,bb as w,a$ as H,aJ as J}from"./index.c3832659.js";import{H as P,E as u,d as x,e as j,t as L,p as R,V as U,h as _,k as $,f as z,g as E}from"./utils.d2e10092.js";const F={class:"relative flex items-center flex-1 flex-shrink-0 py-4 overflow-auto whitespace-nowrap"},I={class:"absolute inset-0 flex flex-1"},X=["placeholder"],W=C({__name:"EnvInput",props:{modelValue:{default:""},placeholder:{default:""},styles:{default:""},envs:{default:null},focus:{type:Boolean,default:!1},selectTextOnMount:{type:Boolean},readonly:{type:Boolean,default:!1}},emits:["update:modelValue","change","paste","enter","keyup","keydown","click"],setup(d,{emit:n}){const l=d,c=y(l.modelValue),o=y(),i=y(null);g(()=>l.modelValue,t=>{var r,s;const a=t.replaceAll(`
`,""),e=(r=o.value)==null?void 0:r.state.doc.toJSON().join(o.value.state.lineBreak);(c.value!==a||t!==e)&&(c.value=a,(s=o.value)==null||s.dispatch({filter:!1,changes:{from:0,to:o.value.state.doc.length,insert:a}}))},{immediate:!0,flush:"sync"});let p=null,v=null;const b=M(J,[]),B=O(()=>l.envs?l.envs.map(t=>({key:t.key,value:t.value,sourceEnv:t.source})):b.value),T=new P(B,o),h=t=>{const a=[u.contentAttributes.of({"aria-label":l.placeholder}),u.updateListener.of(e=>{l.readonly&&(e.view.contentDOM.inputMode="none")}),x.changeFilter.of(()=>!l.readonly),j,l.readonly?u.theme({".cm-content":{caretColor:"var(--secondary-dark-color)",color:"var(--secondary-dark-color)",backgroundColor:"var(--divider-color)",opacity:.25}}):u.theme({}),L({position:"absolute"}),T,R(l.placeholder),u.domEventHandlers({paste(e){var r,s;p=e,v=(s=(r=e.clipboardData)==null?void 0:r.getData("text"))!=null?s:""},drop(e){e.preventDefault()}}),U.fromClass(class{update(e){if(!l.readonly&&e.docChanged){const r=V(c.value);c.value=e.state.doc.toJSON().join(e.state.lineBreak);const s=V(c.value).replaceAll(`
`,"");if(n("update:modelValue",s),n("change",s),!!e.transactions.find(f=>f.isUserEvent("input.paste"))&&p){const f=v;w(()=>{n("paste",{pastedValue:f,prevValue:r})})}else p=null,v=null}}}),_(),$.of([...z])];o.value=new u({parent:t,state:x.create({doc:l.modelValue,extensions:a})})},m=()=>{w(()=>{var t,a;(t=o.value)==null||t.focus(),(a=o.value)==null||a.dispatch({selection:E.create([E.range(0,l.modelValue.length)])})})};return S(()=>{i.value&&(o.value||h(i.value),l.selectTextOnMount&&m())}),g(i,()=>{var t;i.value?(o.value||h(i.value),l.selectTextOnMount&&m()):((t=o.value)==null||t.destroy(),o.value=void 0)}),(t,a)=>(D(),K("div",F,[k("div",I,[k("div",{ref_key:"editor",ref:i,placeholder:d.placeholder,class:N(["flex flex-1",d.styles]),onKeydown:[a[0]||(a[0]=A(H(e=>n("enter",e),["prevent"]),["enter"])),a[3]||(a[3]=e=>n("keydown",e))],onKeyup:a[1]||(a[1]=e=>n("keyup",e)),onClick:a[2]||(a[2]=e=>n("click",e))},null,42,X)])]))}});export{W as _};
//# sourceMappingURL=EnvInput.vue_vue_type_script_setup_true_lang.e761a7d3.js.map
