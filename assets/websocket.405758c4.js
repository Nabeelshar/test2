import{_ as ee}from"./utils.d2e10092.js";import{W as oe,d as te,_ as ae}from"./regex.07a58b49.js";import{f as se,D as ne,ad as le,h as x,ae as h,g as ce,af as re,ag as ie,V as de,X as L,ah as ue,ai as k,aj as pe,o as O,c as me,w as p,e as n,i as d,v as V,j as e,a1 as M,N as R,k as ge,a as l,t as j,ak as ve,al as fe,K as _e,am as be,d as ye,m as he,a6 as ke,a2 as Ce,an as Se,ao as we,ap as xe,aq as Ee,ar as Ne,ac as $e,x as De,a8 as Te,z as Ie,as as Pe,at as We,au as Le,av as Oe,aw as Ve,ax as Me,ay as Re}from"./index.c3832659.js";import{_ as je}from"./Communication.vue_vue_type_script_setup_true_lang.eb326fd8.js";import{I as G}from"./check-circle.40af7866.js";import{d as Ge,I as Ue}from"./index.es.ee4e8c5c.js";import"./date.dcaddfa2.js";import"./lens-actions.b7535d86.js";import"./json.eb0cc1ac.js";import"./newOutline.c045cab3.js";import"./json.63f2d344.js";import"./TaskOption.b54d3c79.js";import"./files.d6386ad7.js";const ze={class:"sticky top-0 z-10 flex flex-shrink-0 p-4 space-x-2 overflow-x-auto bg-primary"},Be={class:"inline-flex flex-1 space-x-2"},Ae=["placeholder","disabled"],He={class:"sticky z-10 flex items-center justify-between flex-shrink-0 pl-4 overflow-x-auto border-b bg-primary border-dividerLight top-upperSecondaryStickyFold"},Fe={class:"font-semibold truncate text-secondaryLight"},Ke={class:"flex"},qe={class:"flex border-b divide-x divide-dividerLight border-dividerLight draggable-content group"},Xe=["onUpdate:modelValue","placeholder","onChange"],Je={key:0,class:"flex flex-col items-center justify-center p-4 text-secondaryLight"},Qe=["src","alt"],Ye={class:"mb-4 text-center"},go=se({__name:"websocket",setup(Ze){const t=ne(),C=ke(),U=Ce(),{subscribeToStream:z}=le(),E=x("communication"),c=h(We,"",Pe),r=h(Oe,[],Le),S=ce({get(){return r.value.map((o,a)=>({id:`protocol-${a}-${o.value}`,protocol:o}))},set(o){r.value=o.map(({protocol:a})=>a)}}),m=h(ie,new re,Ve),i=de(m.value.connectionState$,"DISCONNECTED"),b=h(Re,[],Me),y=x(!0),N=x([]);let g;L(c,o=>{o&&F()}),L(r,o=>{N.value=o.filter(a=>Object.prototype.hasOwnProperty.call(a,"active")?a.active===!0:!0).map(({value:a})=>a)},{deep:!0});const B=({data:o})=>{o.url===c.value&&(y.value=o.result)},A=o=>o instanceof SyntaxError?o.message:t("error.something_went_wrong").toString();ue(()=>{g=new oe,g.addEventListener("message",B),z(m.value.event$,o=>{switch(o==null?void 0:o.type){case"CONNECTING":b.value=[{payload:`${t("state.connecting_to",{name:c.value})}`,source:"info",color:"var(--accent-color)",ts:void 0}];break;case"CONNECTED":b.value=[{payload:`${t("state.connected_to",{name:c.value})}`,source:"info",color:"var(--accent-color)",ts:Date.now()}],C.success(`${t("state.connected")}`);break;case"MESSAGE_SENT":k({payload:o.message,source:"client",ts:Date.now()});break;case"MESSAGE_RECEIVED":k({payload:o.message,source:"server",ts:o.time});break;case"ERROR":k({payload:A(o.error),source:"info",color:"#ff5555",ts:o.time});break;case"DISCONNECTED":k({payload:t("state.disconnected_from",{name:c.value}).toString(),source:"disconnected",color:"#ff5555",ts:o.time}),C.error(`${t("state.disconnected")}`);break}})}),pe(()=>{g&&g.terminate()});const H=()=>{Se()},F=te(function(){g.postMessage({type:"ws",url:c.value})},1e3),$=()=>{if(i.value==="DISCONNECTED")return m.value.connect(c.value,N.value);m.value.disconnect()},K=o=>{m.value.sendMessage(o)},q=()=>{we({value:"",active:!0})},X=o=>{const a=r.value.slice();xe(o),C.success(`${t("state.deleted")}`,{duration:4e3,action:{text:`${t("action.undo")}`,onClick:(T,w)=>{r.value=a,w.goAway()}}})},D=(o,a)=>{Ee(o,a)},J=()=>{b.value=[]};return(o,a)=>{const T=Ne,w=je,I=$e,v=De,Q=Te,Y=ae,Z=ee,f=Ie("tippy");return O(),me(Z,{"layout-id":"websocket"},{primary:p(()=>[n("div",ze,[n("div",Be,[d(n("input",{id:"websocket-url","onUpdate:modelValue":a[0]||(a[0]=s=>M(c)?c.value=s:null),class:R(["w-full px-4 py-2 border rounded bg-primaryLight border-divider text-secondaryDark",{error:!y.value}]),type:"url",autocomplete:"off",spellcheck:"false",placeholder:`${e(t)("websocket.url")}`,disabled:e(i)==="CONNECTED"||e(i)==="CONNECTING",onKeyup:a[1]||(a[1]=ge(s=>y.value?$():null,["enter"]))},null,42,Ae),[[V,e(c)]]),l(T,{id:"connect",disabled:!y.value,class:"w-32",name:"connect",label:e(i)==="CONNECTING"?e(t)("action.connecting"):e(i)==="DISCONNECTED"?e(t)("action.connect"):e(t)("action.disconnect"),loading:e(i)==="CONNECTING",onClick:$},null,8,["disabled","label","loading"])])]),l(Q,{modelValue:E.value,"onUpdate:modelValue":a[4]||(a[4]=s=>E.value=s),styles:"sticky overflow-x-auto flex-shrink-0 bg-primary top-upperPrimaryStickyFold z-10","render-inactive-tabs":""},{default:p(()=>[l(I,{id:"communication",label:`${e(t)("websocket.communication")}`},{default:p(()=>[l(w,{"is-connected":e(i)==="CONNECTED","sticky-header-styles":"top-upperSecondaryStickyFold",onSendMessage:a[2]||(a[2]=s=>K(s))},null,8,["is-connected"])]),_:1},8,["label"]),l(I,{id:"protocols",label:`${e(t)("websocket.protocols")}`},{default:p(()=>[n("div",He,[n("label",Fe,j(e(t)("websocket.protocols")),1),n("div",Ke,[d(l(v,{title:e(t)("action.clear_all"),icon:e(ve),onClick:H},null,8,["title","icon"]),[[f,{theme:"tooltip"}]]),d(l(v,{title:e(t)("add.new"),icon:e(fe),onClick:q},null,8,["title","icon"]),[[f,{theme:"tooltip"}]])])]),l(e(Ge),{modelValue:e(S),"onUpdate:modelValue":a[3]||(a[3]=s=>M(S)?S.value=s:null),"item-key":"id",animation:"250",handle:".draggable-handle",draggable:".draggable-content","ghost-class":"cursor-move","chosen-class":"bg-primaryLight","drag-class":"cursor-grabbing"},{item:p(({element:{protocol:s},index:u})=>{var P,W;return[n("div",qe,[n("span",null,[d(l(v,{icon:e(Ue),class:R(["cursor-auto text-primary hover:text-primary",{"draggable-handle group-hover:text-secondaryLight !cursor-grab":u!==((P=e(r))==null?void 0:P.length)-1}]),tabindex:"-1"},null,8,["icon","class"]),[[f,{theme:"tooltip",delay:[500,20],content:u!==((W=e(r))==null?void 0:W.length)-1?e(t)("action.drag_to_reorder"):null}]])]),d(n("input",{"onUpdate:modelValue":_=>s.value=_,class:"flex flex-1 px-4 py-2 bg-transparent",placeholder:`${e(t)("count.protocol",{count:u+1})}`,name:"message",type:"text",autocomplete:"off",onChange:_=>D(u,{value:_.target.value,active:s.active})},null,40,Xe),[[V,s.value]]),n("span",null,[d(l(v,{title:s.hasOwnProperty("active")?s.active?e(t)("action.turn_off"):e(t)("action.turn_on"):e(t)("action.turn_off"),icon:s.hasOwnProperty("active")?s.active?e(G):e(_e):e(G),color:"green",onClick:_=>D(u,{value:s.value,active:!s.active})},null,8,["title","icon","onClick"]),[[f,{theme:"tooltip"}]])]),n("span",null,[d(l(v,{title:e(t)("action.remove"),icon:e(be),color:"red",onClick:_=>X(u)},null,8,["title","icon","onClick"]),[[f,{theme:"tooltip"}]])])])]}),_:1},8,["modelValue"]),e(r).length===0?(O(),ye("div",Je,[n("img",{src:`/images/states/${e(U).value}/add_category.svg`,loading:"lazy",class:"inline-flex flex-col object-contain object-center w-16 h-16 my-4",alt:`${e(t)("empty.protocols")}`},null,8,Qe),n("span",Ye,j(e(t)("empty.protocols")),1)])):he("",!0)]),_:1},8,["label"])]),_:1},8,["modelValue"])]),secondary:p(()=>[l(Y,{title:e(t)("websocket.log"),log:e(b),onDelete:a[5]||(a[5]=s=>J())},null,8,["title","log"])]),_:1})}}});export{go as default};
//# sourceMappingURL=websocket.405758c4.js.map
