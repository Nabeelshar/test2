import{_ as Le}from"./utils.d2e10092.js";import{o as p,d as x,e as o,f as K,D as Y,h as $,X,c as L,w as v,t as C,j as e,a as c,l as H,bW as ie,F as B,i as k,v as U,k as G,m as ce,x as Z,r as re,ar as de,bX as Me,z as W,K as ue,a6 as pe,H as me,Y as le,b8 as De,ad as qe,ae as I,V as Q,g as Ve,ah as Oe,bY as q,bZ as Re,aj as Qe,a1 as P,N as ne,al as He,b6 as Be,a2 as Ue,b_ as Ae,a_ as ae,am as je,b$ as ze,c0 as Fe,c1 as Pe,c2 as Ge,c3 as We,c4 as Ke,c5 as Ye,c6 as Xe,c7 as Ze,c8 as Je,c9 as et,ca as tt,cb as ot,cc as st}from"./index.c3832659.js";import{I as _e}from"./check-circle.40af7866.js";import{W as lt,d as nt,_ as at}from"./regex.07a58b49.js";import{_ as it,a as ct}from"./Communication.vue_vue_type_script_setup_true_lang.eb326fd8.js";import{_ as rt}from"./EnvInput.vue_vue_type_script_setup_true_lang.e761a7d3.js";import"./date.dcaddfa2.js";import"./lens-actions.b7535d86.js";import"./json.eb0cc1ac.js";import"./newOutline.c045cab3.js";import"./json.63f2d344.js";import"./TaskOption.b54d3c79.js";import"./files.d6386ad7.js";const dt={preserveAspectRatio:"xMidYMid meet",viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"},ut=o("path",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"m9.06 11.9l8.07-8.06a2.85 2.85 0 1 1 4.03 4.03l-8.06 8.08m-6.03-1.01c-1.66 0-3 1.35-3 3.02c0 1.33-2.5 1.52-2 2.02c1.08 1.1 2.49 2.02 4 2.02c2.2 0 4-1.8 4-4.04a3.01 3.01 0 0 0-3-3.02z"},null,-1),pt=[ut];function mt(N,l){return p(),x("svg",dt,pt)}const _t={name:"lucide-brush",render:mt},bt={class:"flex justify-between mb-4"},vt={class:"flex items-center border divide-x rounded border-divider divide-divider"},ft={class:"mx-4"},gt={class:"select-wrapper"},ht={class:"flex flex-col",role:"menu"},yt={class:"relative flex flex-col"},xt=["onKeyup"],Ct={for:"selectLabelAdd"},wt={class:"end-actions"},$t=["title"],Tt={class:"flex space-x-2"},St=K({__name:"Subscription",props:{show:{type:Boolean,default:!1},loadingState:{type:Boolean,default:!1}},emits:["hide-modal","submit"],setup(N,{emit:l}){const d=N,i=pe(),g=Y(),n=$(2),_=$(""),f=$("#f58290");X(()=>d.show,()=>{_.value="",n.value=2;const u=Math.floor(Math.random()*16777215).toString(16);f.value=`#${u}`});const w=()=>{if(!_.value){i.error(g("mqtt.invalid_topic").toString());return}l("submit",{name:_.value,qos:n.value,color:f.value})},m=()=>{_.value="",n.value=2,l("hide-modal")};return(u,r)=>{const y=Z,T=me,V=re("tippy"),E=_t,M=de,A=Me,D=W("focus"),h=W("tippy");return N.show?(p(),L(A,{key:0,dialog:"",title:e(g)("mqtt.new"),onClose:m},{body:v(()=>[o("div",bt,[o("div",vt,[o("label",ft,C(e(g)("mqtt.qos")),1),c(V,{interactive:"",trigger:"click",theme:"popover"},{content:v(({hide:b})=>[o("div",ht,[(p(!0),x(B,null,H(e(ie),S=>(p(),L(T,{key:`qos-${S}`,label:`${S}`,icon:n.value===S?e(_e):e(ue),active:n.value===S,onClick:()=>{n.value=S,b()}},null,8,["label","icon","active","onClick"]))),128))])]),default:v(()=>[o("span",gt,[c(y,{class:"pr-8",label:`${n.value}`},null,8,["label"])])]),_:1})])]),o("div",yt,[k(o("input",{id:"selectLabelAdd","onUpdate:modelValue":r[0]||(r[0]=b=>_.value=b),class:"input floating-input",placeholder:" ",type:"text",autocomplete:"off",onKeyup:G(w,["enter"])},null,40,xt),[[U,_.value],[D]]),o("label",Ct,C(e(g)("action.label")),1),o("span",wt,[k((p(),x("label",{title:e(g)("mqtt.color"),for:"select-color",class:"absolute inset-0 flex items-center justify-center group hover:cursor-pointer"},[c(E,{class:"transition opacity-80 svg-icons group-hover:opacity-100 text-accentContrast"})],8,$t)),[[h,{theme:"tooltip"}]]),k(o("input",{id:"select-color","onUpdate:modelValue":r[1]||(r[1]=b=>f.value=b),type:"color",class:"w-8 h-8 p-1 rounded bg-primary color-picker"},null,512),[[U,f.value]])])])]),footer:v(()=>[o("span",Tt,[c(M,{label:e(g)("mqtt.subscribe"),loading:N.loadingState,outline:"",onClick:w},null,8,["label","loading"]),c(y,{label:e(g)("action.cancel"),outline:"",filled:"",onClick:m},null,8,["label"])])]),_:1},8,["title"])):ce("",!0)}}}),kt={class:"flex flex-col flex-1"},Nt={class:"sticky z-10 flex items-center justify-between flex-shrink-0 py-2 pl-4 pr-2 overflow-x-auto border-b bg-primary border-dividerLight top-upperPrimaryStickyFold"},Et={class:"flex items-center"},It={class:"font-semibold truncate text-secondaryLight"},Lt={class:"flex"},Mt={class:"flex flex-1 h-full border-dividerLight"},Dt={class:"w-1/3 border-r border-dividerLight"},qt={class:"flex flex-1 border-b border-dividerLight"},Vt={class:"flex flex-1 border-b border-dividerLight"},Ot={class:"flex items-center border-b border-dividerLight"},Rt={class:"ml-4 text-secondaryLight"},Qt={class:"w-2/3"},Ht={class:"flex flex-1 border-b border-dividerLight"},Bt={class:"flex flex-1 border-b border-dividerLight"},Ut={class:"flex items-center justify-between px-4 border-b border-dividerLight"},At={class:"flex items-center"},jt={class:"font-semibold truncate text-secondaryLight"},zt={class:"select-wrapper"},Ft={class:"flex flex-col",role:"menu"},Pt=K({__name:"ConnectionConfig",emits:["change"],setup(N,{emit:l}){const d=Y(),i=$({username:"",password:"",keepAlive:"60",cleanSession:!0,lwTopic:"",lwMessage:"",lwQos:0,lwRetain:!1});return X(i,g=>{l("change",g)},{immediate:!0}),(g,n)=>{const _=De,f=rt,w=Z,m=me,u=re("tippy");return p(),x("div",kt,[o("div",Nt,[o("span",Et,[o("label",It,C(e(d)("mqtt.connection_config")),1)]),o("div",Lt,[c(_,{on:i.value.cleanSession,class:"px-2",onChange:n[0]||(n[0]=r=>i.value.cleanSession=!i.value.cleanSession)},{default:v(()=>[le(C(e(d)("mqtt.clean_session")),1)]),_:1},8,["on"])])]),o("div",Mt,[o("div",Dt,[o("div",qt,[c(f,{modelValue:i.value.username,"onUpdate:modelValue":n[1]||(n[1]=r=>i.value.username=r),placeholder:e(d)("authorization.username")},null,8,["modelValue","placeholder"])]),o("div",Vt,[c(f,{modelValue:i.value.password,"onUpdate:modelValue":n[2]||(n[2]=r=>i.value.password=r),placeholder:e(d)("authorization.password")},null,8,["modelValue","placeholder"])]),o("div",Ot,[o("label",Rt,C(e(d)("mqtt.keep_alive")),1),c(f,{modelValue:i.value.keepAlive,"onUpdate:modelValue":n[3]||(n[3]=r=>i.value.keepAlive=r),placeholder:e(d)("mqtt.keep_alive")},null,8,["modelValue","placeholder"])])]),o("div",Qt,[o("div",Ht,[c(f,{modelValue:i.value.lwTopic,"onUpdate:modelValue":n[4]||(n[4]=r=>i.value.lwTopic=r),placeholder:e(d)("mqtt.lw_topic")},null,8,["modelValue","placeholder"])]),o("div",Bt,[c(f,{modelValue:i.value.lwMessage,"onUpdate:modelValue":n[5]||(n[5]=r=>i.value.lwMessage=r),placeholder:e(d)("mqtt.lw_message")},null,8,["modelValue","placeholder"])]),o("div",Ut,[o("div",At,[o("label",jt,C(e(d)("mqtt.lw_qos")),1),c(u,{interactive:"",trigger:"click",theme:"popover"},{content:v(({hide:r})=>[o("div",Ft,[(p(!0),x(B,null,H(e(ie),y=>(p(),L(m,{key:`qos-${y}`,label:`${y}`,icon:i.value.lwQos===y?e(_e):e(ue),active:i.value.lwQos===y,onClick:()=>{i.value.lwQos=y,r()}},null,8,["label","icon","active","onClick"]))),128))])]),default:v(()=>[o("span",zt,[c(w,{class:"pr-8 ml-2 rounded-none",label:`${i.value.lwQos}`},null,8,["label"])])]),_:1})]),c(_,{on:i.value.lwRetain,class:"py-2",onChange:n[6]||(n[6]=r=>i.value.lwRetain=!i.value.lwRetain)},{default:v(()=>[le(C(e(d)("mqtt.lw_retain")),1)]),_:1},8,["on"])])])])])}}}),Gt={class:"sticky top-0 z-10 flex flex-shrink-0 p-4 space-x-2 overflow-x-auto bg-primary"},Wt={class:"inline-flex flex-1 space-x-2"},Kt={class:"flex flex-1"},Yt=["placeholder","disabled"],Xt={for:"client-id",class:"px-4 py-2 font-semibold truncate border-t border-b bg-primaryLight border-divider text-secondaryLight"},Zt=["disabled"],Jt={class:"sticky z-10 flex flex-col flex-shrink-0 overflow-x-auto border-b divide-y rounded-t divide-dividerLight bg-primary border-dividerLight"},eo={class:"flex justify-between flex-1"},to={class:"flex"},oo={key:0,class:"flex flex-col items-center justify-center p-4 text-secondaryLight"},so=["src","alt"],lo={class:"pb-4 text-center"},no={key:1},ao={class:"flex items-stretch group"},io={class:"flex items-center justify-center px-4 cursor-pointer"},co=["onClick"],ro={class:"truncate"},$o=K({__name:"mqtt",setup(N){const l=Y(),d=pe(),i=Ue(),{subscribeToStream:g}=qe(),n=I(Fe,"",ze),_=I(Ge,"",Pe),f=$({username:"",password:"",keepAlive:"60",cleanSession:!0,lwTopic:"",lwMessage:"",lwQos:0,lwRetain:!1}),w=I(Ke,[],We),m=I(Ze,new Xe,Ye),u=Q(m.value.connectionState$,"DISCONNECTED"),r=Q(m.value.subscriptionState$,!1),y=Q(m.value.subscribing$,!1),T=$(!0),V=$("");let E;const M=$(!1),A=Ve(()=>u.value==="CONNECTED"),D=Q(m.value.subscribedTopics$,[]),h=I(et,"",Je),b=I(ot,[],tt),S=t=>{f.value=t},O=t=>{M.value=t},be=({data:t})=>{t.url===n.value&&(T.value=t.result)};Oe(()=>{E=new lt,E.addEventListener("message",be),g(m.value.event$,t=>{switch(t==null?void 0:t.type){case"CONNECTING":w.value=[{payload:`${l("state.connecting_to",{name:n.value})}`,source:"info",color:"var(--accent-color)",ts:void 0}];break;case"CONNECTED":w.value=[{payload:`${l("state.connected_to",{name:n.value})}`,source:"info",color:"var(--accent-color)",ts:Date.now()}],d.success(`${l("state.connected")}`);break;case"MESSAGE_SENT":J({prefix:`${t.message.topic}`,payload:t.message.message,source:"client",ts:Date.now()},t.message.topic);break;case"MESSAGE_RECEIVED":J({prefix:`${t.message.topic}`,payload:t.message.message,source:"server",ts:t.time},t.message.topic);break;case"SUBSCRIBED":O(!1),q({payload:r.value?`${l("state.subscribed_success",{topic:t.topic})}`:`${l("state.unsubscribed_success",{topic:t.topic})}`,source:"server",ts:t.time});break;case"SUBSCRIPTION_FAILED":q({payload:r.value?`${l("state.subscribed_failed",{topic:V.value})}`:`${l("state.unsubscribed_failed",{topic:V.value})}`,source:"server",ts:t.time});break;case"ERROR":q({payload:ye(t.error),source:"info",color:"#ff5555",ts:t.time});break;case"DISCONNECTED":q({payload:l("state.disconnected_from",{name:n.value}).toString(),source:"disconnected",color:"#ff5555",ts:t.time}),d.error(`${l("state.disconnected")}`);break}})});const J=(t,s)=>{s&&Re(s,t),q(t)},ve=nt(function(){E.postMessage({type:"ws",url:n.value})},1e3);X(n,t=>{t&&ve()}),Qe(()=>{E.terminate()});const j=()=>{if(u.value==="DISCONNECTED")return m.value.connect(n.value,_.value,f.value);m.value.disconnect()},fe=t=>{var s;(s=m.value)==null||s.publish(t.eventName,t.message)},ge=t=>{if(A.value){if(D.value.some(s=>s.name===t.name))return d.error(l("mqtt.already_subscribed").toString());m.value.subscribe(t)}else M.value=!1,d.error(l("mqtt.not_connected").toString())},he=t=>{m.value.unsubscribe(t),ee(t)},ye=t=>{if(typeof t=="string")return t;switch(t.type){case"CONNECTION_NOT_ESTABLISHED":return l("state.connection_lost").toString();case"SUBSCRIPTION_FAILED":return l("state.mqtt_subscription_failed",{topic:t.topic}).toString();case"PUBLISH_ERROR":return l("state.publish_error",{topic:t.topic}).toString();case"CONNECTION_LOST":return l("state.connection_lost").toString();case"CONNECTION_FAILED":return l("state.connection_failed").toString();default:return l("state.disconnected_from",{name:n.value}).toString()}},xe=()=>{w.value=[]},Ce=t=>{const{name:s,color:z}=t;if(b.value.some(F=>F.id===t.name))return h.value=t.name;b.value=[...b.value,{id:s,name:s,color:z,removable:!0,logs:[]}],h.value=s},we=t=>{const s=[...b.value];s.splice(t.newIndex,0,s.splice(t.oldIndex,1)[0]),b.value=s},ee=t=>{b.value=b.value.filter(s=>s.id!==t)};return(t,s)=>{const z=de,F=Pt,$e=it,te=ct,Te=at,Se=st,ke=Ae,R=Z,Ne=St,Ee=Le,oe=W("tippy");return p(),L(Ee,{"layout-id":"mqtt"},{primary:v(()=>[o("div",Gt,[o("div",Wt,[o("div",Kt,[k(o("input",{id:"mqtt-url","onUpdate:modelValue":s[0]||(s[0]=a=>P(n)?n.value=a:null),type:"url",autocomplete:"off",class:ne([{error:!T.value},"flex flex-1 w-full px-4 py-2 border rounded-l bg-primaryLight border-divider text-secondaryDark"]),placeholder:`${e(l)("mqtt.url")}`,disabled:e(u)==="CONNECTED"||e(u)==="CONNECTING",onKeyup:s[1]||(s[1]=G(a=>T.value?j():null,["enter"]))},null,42,Yt),[[U,e(n)]]),o("label",Xt,C(e(l)("mqtt.client_id")),1),k(o("input",{id:"client-id","onUpdate:modelValue":s[2]||(s[2]=a=>P(_)?_.value=a:null),class:"flex flex-1 w-full px-4 py-2 border rounded-r bg-primaryLight border-divider text-secondaryDark",spellcheck:"false",disabled:e(u)==="CONNECTED"||e(u)==="CONNECTING",onKeyup:s[3]||(s[3]=G(a=>T.value?j():null,["enter"]))},null,40,Zt),[[U,e(_)]])]),c(z,{id:"connect",disabled:!T.value,class:"w-32",label:e(u)==="CONNECTING"?e(l)("action.connecting"):e(u)==="DISCONNECTED"?e(l)("action.connect"):e(l)("action.disconnect"),loading:e(u)==="CONNECTING",onClick:j},null,8,["disabled","label","loading"])])]),o("div",{class:ne(["flex flex-col flex-1",{"!hidden":e(u)==="CONNECTED"}])},[c(F,{onChange:S})],2),e(u)==="CONNECTED"?(p(),L($e,{key:0,"show-event-field":e(h)==="all","is-connected":e(u)==="CONNECTED","event-field-styles":"top-upperPrimaryStickyFold","sticky-header-styles":e(h)==="all"?"top-upperSecondaryStickyFold":"top-upperPrimaryStickyFold",onSendMessage:s[4]||(s[4]=a=>fe(e(h)==="all"?a:{message:a.message,eventName:e(h)}))},null,8,["show-event-field","is-connected","sticky-header-styles"])):ce("",!0)]),secondary:v(()=>[c(ke,{id:"communication_tab",modelValue:e(h),"onUpdate:modelValue":s[6]||(s[6]=a=>P(h)?h.value=a:null),"can-add-new-tab":!1,onRemoveTab:ee,onSort:we},{default:v(()=>[(p(!0),x(B,null,H(e(b),a=>(p(),L(Se,{id:a.id,key:"removable_tab_"+a.id,label:a.name,"is-removable":a.removable},{icon:v(()=>[c(te,{style:ae({color:a.color}),class:"w-4 h-4 svg-icons"},null,8,["style"])]),default:v(()=>[c(Te,{title:e(l)("mqtt.log"),log:a.id==="all"?e(w):a.logs,onDelete:s[5]||(s[5]=se=>xe())},null,8,["title","log"])]),_:2},1032,["id","label","is-removable"]))),128))]),_:1},8,["modelValue"])]),sidebar:v(()=>[o("div",Jt,[o("div",eo,[c(R,{icon:e(He),label:e(l)("mqtt.new"),class:"!rounded-none",onClick:s[7]||(s[7]=a=>O(!0))},null,8,["icon","label"]),o("span",to,[k(c(R,{to:"https://docs.hoppscotch.io/features/mqtt",blank:"",title:e(l)("app.wiki"),icon:e(Be)},null,8,["title","icon"]),[[oe,{theme:"tooltip"}]])])])]),e(D).length===0?(p(),x("div",oo,[o("img",{src:`/images/states/${e(i).value}/pack.svg`,loading:"lazy",class:"inline-flex flex-col object-contain object-center w-16 h-16 my-4",alt:`${e(l)("empty.subscription")}`},null,8,so),o("span",lo,C(e(l)("empty.subscription")),1),c(R,{label:e(l)("mqtt.new"),filled:"",outline:"",onClick:s[8]||(s[8]=a=>O(!0))},null,8,["label"])])):(p(),x("div",no,[(p(!0),x(B,null,H(e(D),(a,se)=>(p(),x("div",{key:`subscription-${se}`,class:"flex flex-col"},[o("div",ao,[o("span",io,[c(te,{style:ae({color:a.color}),class:"w-4 h-4 svg-icons"},null,8,["style"])]),o("span",{class:"flex flex-1 min-w-0 py-2 pr-2 transition cursor-pointer group-hover:text-secondaryDark",onClick:Ie=>Ce(a)},[o("span",ro,C(a.name),1)],8,co),k(c(R,{icon:e(je),color:"red",title:e(l)("mqtt.unsubscribe"),class:"hidden group-hover:inline-flex","data-testid":"unsubscribe_mqtt_subscription",onClick:Ie=>he(a.name)},null,8,["icon","title","onClick"]),[[oe,{theme:"tooltip"}]])])]))),128))])),c(Ne,{show:M.value,"loading-state":e(y),onSubmit:ge,onHideModal:s[9]||(s[9]=a=>O(!1))},null,8,["show","loading-state"])]),_:1})}}});export{$o as default};
//# sourceMappingURL=mqtt.66bee222.js.map
